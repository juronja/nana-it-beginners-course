<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Document</title>

    <link rel="stylesheet" href="style.css">

    <script>
        async function loadTasks() {
            get = await fetch("get-task", {
                method: "GET",
                headers: {
                    "Accept": "application/json",
                    "Content-Type": "application/json"
                }
            })

            for (task of (await get.json()).tasks) {
                listElement = document.createElement("li")
                listElement.textContent = task
                
                document.getElementById("tasks").appendChild(listElement)
            }
        }


        async function handleSaveTask() {
            inputElement = document.getElementById("task-input")
            listElement = document.createElement("li")
            
            listElement.textContent = inputElement.value
            document.getElementById("tasks").appendChild(listElement)

            payload = {
                task: inputElement.value
            }

            // Fetch function sends the payload to a url in json format.
            // Important to make all other functions "async" otherwise it won't get executed.
            response = await fetch("save-task", {
                method: "POST",
                body: JSON.stringify(payload),
                headers: {
                    "Accept": "application/json",
                    "Content-Type": "application/json"
                }
            })

            console.log(await response.json())
        }

    </script>
</head>
<body onload="loadTasks()">
    <div>
        <label for="">Add Task</label>
        <input id="task-input" type="text" placeholder="new task"/>
        <button onclick="handleSaveTask()">Save</button>
        <ul id="tasks"></ul>
    </div>
</body>
</html>